<html>
  <head>
    <script src="../../src/util/PieCloudLoader.js"></script>
  </head>
  <body>

    <pie-multiple-choice name="world"></pie-multiple-choice>

    <script>
      
      // Add a Mock for Pie Element
      // NOTE - tried setting this in spec but couldn't make it work.
      class MockElement extends HTMLElement {
        constructor() {
          super();
          console.log('constructing mock el');
          const shadow = this.attachShadow({mode: 'open'});
          const name  =  this.getAttribute('name');
          const helloEl = document.createElement('div');
          helloEl.textContent = `hello pie ${name}`;
          shadow.appendChild(helloEl);
        
        }

      }


      
      // override src download,and put mock definition in global 
      Object.defineProperty(HTMLScriptElement.prototype, 'src', {

        set(src) {
          // add mock element to global, script onload will use this
          window['pie'] = {
            'default' : {
              '@pie-elements/multiple-choice': {
                "Element": MockElement
              }
            }
          }

          const packageName = src.substr(src.lastIndexOf('@'), src.lastIndexOf('/') - src.lastIndexOf('@'))
          const scriptEl = document.createElement('div');
          scriptEl.id = packageName;
          scriptEl.textContent = `added script: ${packageName}`;
          document.body.appendChild(scriptEl);
          
        }
      });

      
      pieCloudLoader({
        'pie-multiple-choice': '@pie-elements/multiple-choice'
      }, document);

      const addedScript = document.getElementById('pie-multiple-choice');
      // onload will define the MockElement in customelements
      addedScript.onload();


    </script>

   

  </body>
</html>